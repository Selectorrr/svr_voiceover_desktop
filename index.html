<!DOCTYPE html>
<html lang="ru" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy"
          content="
          default-src 'self';
          script-src 'self' https://cdn.jsdelivr.net;
          style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com;
          font-src 'self' https://cdn.jsdelivr.net https://fonts.gstatic.com;
          img-src 'self' data:;
        ">
    <title>SVR Voiceover Desktop</title>
    <!-- Bootstrap CSS + Icons + Animate -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
          rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
          rel="stylesheet">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"/>
    <style>
        html, body {
            margin: 0;
            padding: 0;
        }

        #titleBar {
            position: sticky;
            top: 0;
            z-index: 1000;
            -webkit-app-region: drag;
            height: 32px;
            width: 100%;
            background-color: var(--bs-body-bg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 8px;
            border-bottom: 1px solid var(--bs-border-color);
        }

        #titleBar .no-drag,
        button, input, select, .form-control, .form-select, .input-group-text {
            -webkit-app-region: no-drag;
        }

        #titleBar .btn {
            border: none !important;
            box-shadow: none !important;
            background: transparent;
            padding: 0 4px;
        }

        .rotate-icon {
            transition: transform .3s ease;
        }

        .collapsed + .rotate-icon {
            transform: rotate(0);
        }

        .rotate-icon {
            transform: rotate(90deg);
        }

        .bi-info-circle-fill {
            cursor: pointer;
        }

        .container {
            padding-top: 32px;
        }

        #stopBtn:disabled, #runBtn:disabled {
            display: none;
        }

        .accordion-button.accordion-button-sm {
            padding: .5rem .75rem;
            font-size: .9rem;
        }

        .accordion-body {
            padding: .75rem;
        }
    </style>
</head>
<body class="bg-body text-body">
<div id="titleBar">
    <div class="d-flex align-items-center">
        <i class="bi bi-mic-fill me-1"></i><span>SVR Voiceover Desktop</span>
    </div>
    <div class="d-flex no-drag">
        <button id="themeToggle" class="btn btn-sm"><i class="bi bi-sun-fill"></i></button>
        <button id="minimizeBtn" class="btn btn-sm mx-1"><i class="bi bi-dash-lg"></i></button>
        <button id="closeBtn" class="btn btn-sm"><i class="bi bi-x-lg"></i></button>
    </div>
</div>

<div class="container pt-4">
    <form id="run-form" class="row g-3 needs-validation" novalidate>

        <!-- API Key -->
        <div class="col-md-6">
            <label for="api_key" class="form-label small">
                <i class="bi bi-key-fill me-1"></i>Ключ доступа
            </label>
            <div class="input-group input-group-sm">
                <input type="text" id="api_key" class="form-control form-control-sm" required
                       placeholder="Ключ доступа">
                <span class="input-group-text info-trigger"
                      data-info="Ваш уникальный API-ключ можно получить у Telegram-бота <a href='https://t.me/SynthVoiceRuBot' target='_blank'>@SynthVoiceRuBot</a>.">
                    <i class="bi bi-info-circle-fill"></i>
                </span>
                <div class="invalid-feedback">Укажите API-ключ</div>
            </div>
        </div>

        <!-- Фильтр по пути -->
        <div class="col-md-6">
            <label for="path_filter" class="form-label small">
                <i class="bi bi-filter-circle-fill me-1"></i>Фильтр реплик по пути файла
            </label>
            <div class="input-group input-group-sm">
                <input type="text" id="path_filter" class="form-control form-control-sm"
                       placeholder="Например: Audio/cutscene/">
                <span class="input-group-text info-trigger"
                      data-info="Если указано, в озвучку пойдут только те строки, у которых путь к аудиофайлу начинается с этого значения.">
            <i class="bi bi-info-circle-fill"></i>
        </span>
            </div>
        </div>


        <!-- Формат -->
        <div class="col-md-6">
            <label for="ext" class="form-label small">
                <i class="bi bi-file-earmark-music-fill me-1"></i>Формат
            </label>
            <div class="input-group input-group-sm">
                <select id="ext" class="form-select form-select-sm" required>
                    <option value="ogg">ogg</option>
                    <option value="wav" selected>wav</option>
                    <option value="flac">flac</option>
                </select>
                <span class="input-group-text info-trigger"
                      data-info="
          <strong>ogg</strong> – экономит место, но может чуть снизить качество;<br/>
          <strong>wav</strong> – сохраняет максимальное качество, но файлы получаются большими;<br/>
          <strong>flac</strong> – обеспечивает хорошее сжатие без потери качества,
          но не все программы поддерживают этот формат при дальнейшей обработке.
        "> <i class="bi bi-info-circle-fill"></i> </span>
                <div class="invalid-feedback">Укажите формат</div>
            </div>
        </div>

        <!-- Рабочая папка -->
        <div class="col-12 needs-validation">
            <div class="input-group input-group-sm">
    <span class="input-group-text bg-secondary border-0 text-light p-1 no-drag">
      <i class="bi bi-folder2-open"></i>
    </span>
                <input
                        type="text"
                        id="workdir"
                        class="form-control form-control-sm bg-secondary text-light border-0"
                        placeholder="Выберите рабочую папку"
                        readonly
                        required
                >
                <button
                        id="chooseDirBtn"
                        type="button"
                        class="btn btn-outline-secondary btn-sm no-drag"
                >Выбрать…
                </button>
                <button
                        id="openDirBtn"
                        type="button"
                        class="btn btn-outline-secondary btn-sm no-drag ms-1"
                        disabled
                ><i class="bi bi-folder2-open"></i></button>

                <!-- Иконка заполнить примером -->
                <button
                        id="populateSampleBtn"
                        type="button"
                        class="btn btn-outline-secondary btn-sm no-drag ms-1 d-none p-1"
                        data-bs-toggle="tooltip"
                        data-bs-placement="top"
                        title="Заполнить папку примером данных"
                >
                    <i class="bi bi-file-earmark-arrow-down-fill"></i>
                </button>

                <div class="invalid-feedback">
                    Необходимо указать рабочую папку.
                </div>
            </div>
            <div class="form-text text-muted small">
                Ваш каталог с файлами для обработки.
            </div>
        </div>


        <div class="col-md-3">
            <label for="csv_delimiter" class="form-label small">
                <i class="bi bi-slash me-1"></i>CSV-разделитель
            </label>
            <div class="input-group input-group-sm">
                <input type="text" id="csv_delimiter"
                       class="form-control form-control-sm"
                       value="," maxlength="1">
                <span class="input-group-text info-trigger"
                      data-info="Символ-разделитель колонок в CSV (по умолчанию «,»).">
                    <i class="bi bi-info-circle-fill"></i>
                </span>
            </div>
        </div>

        <!-- Дополнительные настройки -->
        <div class="col-12 d-flex justify-content-between align-items-center">
            <!-- Кнопка «Доп. настройки» -->
            <a class="btn btn-link p-0 small collapsed"
               data-bs-toggle="collapse" href="#advancedOptions"
               role="button" aria-expanded="false">
                <i class="bi bi-sliders rotate-icon me-1"></i>Доп. настройки
            </a>
            <div class="d-flex align-items-center">
                Баланс: <span id="charCount"> – </span>
                <i class="bi bi-info-circle-fill ms-1 info-trigger"
                   data-info="Баланс можно пополнить через Telegram-бота <a href='https://t.me/SynthVoiceRuBot' target='_blank'>@SynthVoiceRuBot</a>."></i>
            </div>

        </div>

        <!-- Тело «Доп. настройки» остаётся без изменений -->
        <div class="collapse mt-2 animate__animated animate__fadeIn" id="advancedOptions">
            <div class="card p-3">
                <div class="row g-3">
                    <!-- Более тонкие настройки -->
                    <div class="accordion mt-3" id="advancedAccordion">

                        <!-- Просодия и VC -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingProsody">
                                <button class="accordion-button accordion-button-sm" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#collapseProsody"
                                        aria-expanded="false" aria-controls="collapseProsody">
                                    <i class="bi bi-music-note-beamed me-2"></i>Просодия и VC
                                </button>
                            </h2>
                            <div id="collapseProsody" class="accordion-collapse collapse show"
                                 aria-labelledby="headingProsody" data-bs-parent="#advancedAccordion">
                                <div class="accordion-body">
                                    <div class="row g-3">
                                        <div class="col-md-3">
                                            <label for="vc_type" class="form-label x-small">Тип конверсии голоса
                                                (VC)</label>
                                            <div class="input-group input-group-sm">
                                                <select id="vc_type" class="form-select form-select-sm">
                                                    <option value="default">default</option>
                                                    <option value="native_bigvgan">native_bigvgan</option>
                                                    <option value="native_vocos">native_vocos</option>
                                                </select>
                                                <span class="input-group-text info-trigger"
                                                      data-info="VC тип — это режим конверсии голоса. <br><b>default</b> — Отличное качество человеческой речи, но плохо подходит для речи с эффектами — например, радио или робота. <br><b>native_bigvgan</b> — Среднее качество голоса (металический оттенок), но отлично подходит для речи с эффектами (эхо, робот). <br><b>native_vocos</b> — Альтернатива для <b>native_bigvgan</b> среднее качество голосов, нет металлического оттенка.">
                                                <i class="bi bi-info-circle-fill"></i>
                                            </span>
                                            </div>

                                            <!-- только для vc_type=default -->
                                            <div id="vc_default_alpha_wrap">
                                                <div class="mt-2">
                                                    <label class="form-label x-small mb-1">Просодия ↔ тембр (default)</label>
                                                    <div class="d-flex align-items-center gap-2">
                                                        <input type="range" id="vc_default_alpha_range" class="form-range" min="0"
                                                               max="1" step="0.01" value="0.6" style="margin:0;">
                                                        <input type="number" id="vc_default_alpha"
                                                               class="form-control form-control-sm" value="0.6" min="0" max="1"
                                                               step="0.01" style="width:90px;">
                                                        <i class="bi bi-info-circle-fill info-trigger"
                                                           data-info="<div>
    <b>Меньше</b> — голос звучит <b>ровнее и одинаковее</b> (персонаж не “скачет” по голосам), эмоций <b>меньше</b>.<br>
    <b>Больше</b> — эмоций <b>больше</b> (крик, шёпот), но голос может <b>меняться</b> от фразы к фразе.
  </div>

  <br>

  <div><b>Рекомендации:</b></div>
  <ul>
    <li><b>0.6</b> — обычная человеческая речь</li>
    <li><b>0.8</b> — речь с эффектами (радио, робот, инопланетные голоса)</li>
  </ul>"></i>
                                                    </div>
                                                </div>
                                                <div class="mt-2">
                                                    <label for="min_target_sec" class="form-label x-small">Мин. длина семпла (сек.)</label>
                                                    <div class="input-group input-group-sm">
                                                        <input type="number" id="min_target_sec"
                                                               class="form-control form-control-sm"
                                                               value="3.0" step="0.1" min="0">
                                                        <span class="input-group-text info-trigger"
                                                              data-info="<div>
  <b>Меньше</b> — инференс <b>быстрее</b> и результат чаще <b>похож на исходный сэмпл</b>, но на <b>коротких семплах</b> возможны <b>артефакты</b> (шум).<br>
  <b>Больше</b> — влияет в основном на <b>короткие семплы</b>: инференс <b>дольше</b>, зато <b>меньше шума</b>, голос звучит <b>ровнее</b>, но эмоций может быть <b>меньше</b>.
  <br>

  <div><b>Рекомендация:</b> <b>3.5</b> сек.</div>
</div>">
                                                <i class="bi bi-info-circle-fill"></i>
                                            </span>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <label class="form-label x-small">Следовать оригинальной просодии</label>
                                            <div class="d-flex align-items-center gap-2">
                                                <input type="range" id="prosody_cond_range" class="form-range" min="0"
                                                       max="1" step="0.05" value="0.6" style="margin:0;">
                                                <input type="number" id="prosody_cond"
                                                       class="form-control form-control-sm" value="0.6" min="0" max="1"
                                                       step="0.05" style="width:90px;">
                                                <i class="bi bi-info-circle-fill info-trigger"
                                                   data-info="<b>Следовать оригинальной просодии</b><br><br><span><b>0</b> — максимально повторять паузы и интонации из сэмпла</span><br>
  <span><b>1</b> — почти не учитывать паузы и интонации из сэмпла больше опираться на текст</span>
  <br>
  <br>
  <div>
    <b>Меньше</b> — речь сильнее <b>похожа на оригинал</b> (включая паузы между словами). Если сэмпл <b>не на русском</b>,
    паузы и интонации могут звучать <b>неестественно</b> для русской речи.<br>
    <b>Больше</b> — речь обычно <b>естественнее</b> и может быть <b>эмоциональнее</b>: акцент больше на <b>тексте</b>, а не на паузах/интонациях из сэмпла.
  </div>

  <br>

  <div><b>Рекомендации:</b></div>
  <ul>
    <li><b>0.6</b> — межъязыковое клонирование</li>
    <li><b>0.3</b> — клонирование русской речи</li>
  </ul>"></i>
                                            </div>
                                        </div>

                                        <div class="col-md-3">
                                            <label for="min_prosody_len" class="form-label x-small">Мин. длина
                                                просодии</label>
                                            <div class="input-group input-group-sm">
                                                <input type="number" id="min_prosody_len"
                                                       class="form-control form-control-sm"
                                                       value="0" step="0.1" min="0">
                                                <span class="input-group-text info-trigger"
                                                      data-info="<b>Мин. длина просодии (сек.)</b><br>
  Если сэмпл фразы короче этого значения, он будет заменен на сэмпл тембра.

  <br><br>

  <div>
    Очень короткие <b>эмоциональные</b> сэмплы иногда дают <b>шум</b> и <b>неразборчивую</b> речь.
    В таких случаях лучше <b>не использовать их</b> и взять сэмпл <b>тембра</b>.<br>
    Если короткие фразы получаются неразборчивыми — поставь значение <b>выше 0</b> но лучше не более 1с.
    По умолчанию: <b>0</b>.
  </div>">
                                                <i class="bi bi-info-circle-fill"></i>
                                            </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Тембр и качество -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingQuality">
                                <button class="accordion-button accordion-button-sm collapsed" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#collapseQuality"
                                        aria-expanded="true" aria-controls="collapseQuality">
                                    <i class="bi bi-soundwave me-2"></i>Тембр и качество
                                </button>
                            </h2>
                            <div id="collapseQuality" class="accordion-collapse collapse"
                                 aria-labelledby="headingQuality" data-bs-parent="#advancedAccordion">
                                <div class="accordion-body">
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <label for="tone_sample_len" class="form-label x-small">
                                                <i class="bi bi-person-voice me-1"></i>Длина сэмпла голоса
                                            </label>
                                            <div class="input-group input-group-sm">
                                                <input type="number" id="tone_sample_len"
                                                       class="form-control form-control-sm"
                                                       value="7500" min="1000" step="100">
                                                <span class="input-group-text info-trigger"
                                                      data-info="Сколько миллисекунд исходного голоса собирать в сэмпл (тембр). Больше — стабильнее тембр, но дольше подготовка.">
                                                <i class="bi bi-info-circle-fill"></i>
                                            </span>
                                            </div>
                                        </div>

                                        <div class="col-md-4 d-flex flex-column justify-content-end">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" role="switch"
                                                       id="is_respect_mos" checked>
                                                <label class="form-check-label x-small" for="is_respect_mos">
                                                    <i class="bi bi-stars me-1"></i>Учитывать качество (MOS)
                                                    <i class="bi bi-info-circle-fill ms-1 info-trigger"
                                                       data-info="Если включено — то тембр будет качественным и голос чище, работать будет медленее."></i>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Подбор скорости -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingSpeed">
                                <button class="accordion-button accordion-button-sm collapsed"
                                        type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpeed"
                                        aria-expanded="false" aria-controls="collapseSpeed">
                                    <i class="bi bi-speedometer2 me-2"></i>Подбор скорости
                                </button>
                            </h2>
                            <div id="collapseSpeed" class="accordion-collapse collapse"
                                 aria-labelledby="headingSpeed" data-bs-parent="#advancedAccordion">
                                <div class="accordion-body">
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <label for="speed_search_attempts" class="form-label x-small">Попытки подбора</label>
                                            <div class="input-group input-group-sm">
                                                <input type="number" id="speed_search_attempts"
                                                       class="form-control form-control-sm"
                                                       value="6" min="0" step="1">
                                                <span class="input-group-text info-trigger"
                                                      data-info="<b>Попытки подбора</b><br>
  Сколько раз уточнять скорость после первого прогона.

  <br><br>

  <div>
    Обычно скорость угадывается уже с первой попытки (примерно в 90% случаев).
    Если не попали — делаются дополнительные уточнения.<br>
    <b>Больше</b> попыток — инференс может быть <b>дольше</b>, но результат обычно <b>точнее по длительности</b>.
  </div>

  <br>

  <div><b>Рекомендация:</b> <b>3</b></div>">
                                                    <i class="bi bi-info-circle-fill"></i>
                                                </span>
                                            </div>
                                        </div>

                                        <div class="col-md-4">
                                            <label for="speed_adjust_step_pct" class="form-label x-small">Шаг уточнения, %</label>
                                            <div class="input-group input-group-sm">
                                                <input type="number" id="speed_adjust_step_pct"
                                                       class="form-control form-control-sm"
                                                       value="0.08" min="0" step="0.01">
                                                <span class="input-group-text info-trigger"
                                                      data-info="Y: на сколько менять скорость за одну попытку (0.08 = 8%).">
                                                    <i class="bi bi-info-circle-fill"></i>
                                                </span>
                                            </div>
                                        </div>

                                        <div class="col-md-4">
                                            <label for="speed_clip_min" class="form-label x-small">Мин скорость</label>
                                            <div class="input-group input-group-sm">
                                                <input type="number" id="speed_clip_min"
                                                       class="form-control form-control-sm"
                                                       value="0.5" min="0" step="0.01">
                                                <span class="input-group-text info-trigger"
                                                      data-info="<b>Мин. скорость %</b><br>
  Минимально допустимая скорость речи в процентах по отношению к сэмплу.

  <br><br>

  <div>
    Иногда в сэмпле бывает много <b>тишины</b>, и его длительность не совпадает с реальной речью.
    Этот параметр задаёт, насколько <b>медленно</b> модель вообще может говорить.<br>
    Если результат получается слишком <b>размеренным</b> или появляются <b>лишние звуки в конце</b> фраз - попробуй <b>увеличить</b> это значение.
  </div>">
                                                    <i class="bi bi-info-circle-fill"></i>
                                                </span>
                                            </div>
                                        </div>

                                        <div class="col-md-4">
                                            <label for="speed_clip_max" class="form-label x-small">Макс скорость</label>
                                            <div class="input-group input-group-sm">
                                                <input type="number" id="speed_clip_max"
                                                       class="form-control form-control-sm"
                                                       value="2.0" min="0" step="0.01">
                                                <span class="input-group-text info-trigger"
                                                      data-info="<b>Макс. скорость</b><br>
  <div>
    Ограничивает, насколько сильно модель может <b>ускорять</b> речь.
    Если модель начинает тараторить, <b>заговаривается</b> и речь <b>разваливается</b> — снизь это значение.<br>
    Рекомендуется держать <b>не выше 1.2</b> (это примерно <b>+20%</b>).
  </div>">
                                                    <i class="bi bi-info-circle-fill"></i>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="max_extra_speed" class="form-label x-small">Макс. доп.
                                                ускорение</label>
                                            <div class="input-group input-group-sm">
                                                <input type="number" id="max_extra_speed"
                                                       class="form-control form-control-sm"
                                                       value="0.15" step="0.01" min="0" max="1">
                                                <span class="input-group-text info-trigger"
                                                      data-info="Насколько можно дополнительно ускорить речь при необходимости (доля: <b>0.10 = 10%</b>).

  <br><br>

  <div>
    Это <b>программная</b> коррекция длительности (через <b>ffmpeg atempo</b>) уже <b>после</b> синтеза,
    когда речь получилась <b>разборчивой</b>.<br>
    Помогает слегка <b>ускорить</b> или <b>замедлить</b> фразу, почти не теряя <b>разборчивость</b>.<br>
    Также может <b>уменьшить число попыток подбора скорости</b>, потому что допуск по времени становится шире.
  </div>

  <br>

  <div><b>Рекомендация:</b> <b>0.10</b> (10%)</div>">
                                                <i class="bi bi-info-circle-fill"></i>
                                            </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTech">
                                <button class="accordion-button accordion-button-sm collapsed" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#collapseTech"
                                        aria-expanded="false" aria-controls="collapseTech">
                                    <i class="bi bi-wrench-adjustable-circle me-2"></i>Техническое
                                </button>
                            </h2>
                            <div id="collapseTech" class="accordion-collapse collapse"
                                 aria-labelledby="headingTech" data-bs-parent="#advancedAccordion">
                                <div class="accordion-body">
                                    <!-- Устройство -->
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <label for="device" class="form-label x-small">
                                                <i class="bi bi-hdd-network-fill me-1"></i>Устройство
                                            </label>
                                            <div class="input-group input-group-sm">
                                                <select id="device" class="form-select form-select-sm">
                                                    <option value="CUDAExecutionProvider" selected>GPU (CUDA) + CPU
                                                    </option>
                                                    <option value="CPUExecutionProvider">Только CPU</option>
                                                </select>
                                                <span class="input-group-text info-trigger"
                                                      data-info="Выберите устройство для ONNX Runtime. <br/><br/>
<strong>GPU (CUDA) + CPU</strong> — используется CUDA, а CPU остаётся запасным провайдером;<br/>
<strong>Только CPU</strong> — если нет NVIDIA GPU или нужно отладить. <br/><br/>Если у вас несколько видеокарт, будут использоваться все.">
                                <i class="bi bi-info-circle-fill"></i>
                            </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <label for="reinit_every" class="form-label x-small">Reinit every</label>
                                            <div class="input-group input-group-sm">
                                                <input type="number" id="reinit_every"
                                                       class="form-control form-control-sm" value="0" min="0" step="1">
                                                <span class="input-group-text info-trigger"
                                                      data-info="Как часто перезагружать ONNX-сессию (каждые <b>N</b> запусков). Это помогает освобождать память видеокарты, если VRAM не хватает. <br>0 — не перезагружать.">
                                                <i class="bi bi-info-circle-fill"></i>
                                            </span>
                                            </div>
                                        </div>
                                        <!-- Потоки -->
                                        <div class="col-md-4">
                                            <label for="n_jobs" class="form-label x-small">
                                                <i class="bi bi-gear-fill me-1"></i>Потоки
                                            </label>
                                            <div class="input-group input-group-sm">
                                                <input type="number" id="n_jobs"
                                                       class="form-control form-control-sm"
                                                       placeholder="Авто" min="1" disabled>
                                                <span class="input-group-text info-trigger"
                                                      data-info="Один поток обычно занимает до ~12 ГБ видеопамяти. Если у вашей видеокарты ≥24 ГБ, можно увеличить число потоков для более эффективного использования GPU. При этом пропорционально увеличьте размер партии.">
                                <i class="bi bi-info-circle-fill"></i>
                        </span>
                                            </div>
                                            <div class="form-check form-switch mt-1">
                                                <input class="form-check-input" type="checkbox" role="switch"
                                                       id="n_jobs_auto" checked>
                                                <label class="form-check-label small" for="n_jobs_auto">Авто (по числу
                                                    GPU)</label>
                                            </div>
                                        </div>
                                        <!-- Размер партии -->
                                        <div class="col-md-4">
                                            <label for="batch_size" class="form-label x-small">
                                                <i class="bi bi-stack me-1"></i>Размер партии
                                            </label>
                                            <div class="input-group input-group-sm">
                                                <input type="number" id="batch_size"
                                                       class="form-control form-control-sm"
                                                       value="32" min="1" max="128">
                                                <span class="input-group-text info-trigger"
                                                      data-info="API токенизатора ограничен 30 запросами/мин. Увеличивайте размер партии, чтобы снизить число запросов.">
                                <i class="bi bi-info-circle-fill"></i>
                        </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>


        <div class="col-12 d-flex flex-column gap-2">

            <!-- Прогресс + стоп -->
            <div class="d-flex justify-content-end align-items-center">
                <div class="d-flex align-items-center me-2 flex-grow-1">
                    <div id="progressInline"
                         class="progress flex-grow-1 d-none"
                         style="height:0.5rem;">
                        <div class="progress-bar progress-bar-striped progress-bar-animated"
                             role="progressbar" style="width:0%"></div>
                    </div>
                    <span id="progressLabel" class="small text-muted ms-2 d-none"></span>
                </div>

                <button id="stopBtn" type="button" class="btn btn-danger btn-sm no-drag" disabled>
                    <i class="bi bi-stop-fill"></i>
                    <span id="stopSpinner" class="spinner-border spinner-border-sm ms-1 d-none"
                          role="status"></span>
                </button>
            </div>

            <!-- Кнопки стадий по вертикали -->
            <div class="d-flex flex-column gap-2">

                <!-- 1. Озвучка — зелёная -->
                <button id="runBtn" type="submit"
                        class="btn btn-success btn-sm no-drag w-100 d-flex justify-content-center align-items-center">
                    1. Выполнить озвучку
                    <span id="runSpinner" class="spinner-border spinner-border-sm ms-2 d-none" role="status"></span>
                </button>

                <!-- 2. Lipsync -->
                <button id="lipsyncBtn" type="button"
                        class="btn btn-outline-secondary btn-sm no-drag w-100 d-flex justify-content-center align-items-center">
                    2. Выполнить lipsync
                    <span id="lipsyncSpinner" class="spinner-border spinner-border-sm ms-2 d-none"
                          role="status"></span>
                </button>

                <!-- 3. Выровнять длину -->
                <button id="alignBtn" type="button"
                        class="btn btn-outline-secondary btn-sm no-drag w-100 d-flex justify-content-center align-items-center">
                    3. Выровнять длину
                    <span id="alignSpinner" class="spinner-border spinner-border-sm ms-2 d-none"
                          role="status"></span>
                </button>

                <!-- 4. Свести закадр -->
                <button id="mixingBtn" type="button"
                        class="btn btn-outline-secondary btn-sm no-drag w-100 d-flex justify-content-center align-items-center">
                    4. Свести закадр
                    <span id="mixingSpinner" class="spinner-border spinner-border-sm ms-2 d-none"
                          role="status"></span>
                </button>

            </div>
        </div>

    </form>

    <!-- Логи -->
    <div class="card mt-4">
        <div class="card-header d-flex align-items-center">
            <button class="btn btn-link text-decoration-none p-0 d-flex align-items-center"
                    data-bs-toggle="collapse" data-bs-target="#logsCollapse"
                    aria-expanded="false" aria-controls="logsCollapse">
                <i id="logsToggleIcon" class="bi bi-chevron-down me-1"></i>Логи
            </button>
            <div class="ms-auto">
                <button id="clearLogsBtn" class="btn btn-outline-secondary btn-sm me-1">
                    <i class="bi bi-trash"></i>
                </button>
                <button id="copyLogsBtn" class="btn btn-outline-secondary btn-sm">
                    <i class="bi bi-clipboard"></i>
                </button>
            </div>
        </div>
        <div id="logsCollapse" class="collapse">
            <pre id="logs" class="card-body"
                 style="height:200px; overflow:auto; font-family:monospace; font-size:.85rem;"></pre>
        </div>
    </div>

</div>

<!-- Модал подсказок -->
<div class="modal fade" id="infoModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title">Подсказка</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="infoModalBody"></div>
        </div>
    </div>
</div>


<!-- Toast контейнер -->
<div id="toastContainer" class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index:1100;"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="./renderer.js"></script>
</body>
</html>
